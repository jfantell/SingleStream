<!DOCTYPE html>
<html class="no-js" ng-app="myApp"> <!--   --> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Music App</title>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>

        <link rel="stylesheet" href="style.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.1/modernizr.min.js"></script>
        <link href='http://fonts.googleapis.com/css?family=Lato:300' rel='stylesheet' type='text/css'>

        <!-- // <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script> -->
		    <!-- // <script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script> -->

        <!-- // <script src="jquery-3.1.1.min.js"></script> -->
        <script src="handlebars.min.js"></script>
        <script src="jquery-1.10.1.min.js"></script>
<!-- 		<link href='https://d2c87l0yth4zbw.cloudfront.net/css/80278a9.css' rel='stylesheet' type='text/css'>
 -->
    </head>
<body>


<main ng-controller="myCtrl">   
    <div class="input">  
     <form id="search-form"> 
      <input type="text" id="query" class="form-control" ng-model="look" autofocus placeholder="Type Artist Name.." autocomplete="off">
      <input type="submit" id="search" class="btn btn-primary" value="Search" />
    </div>
  </form>
  <div id="results"></div>
    <h1 ng-show="look">Searching for ... {{look}}</h1>

  </main>





<script id="results-template" type="text/x-handlebars-template">
  {{#each albums.items}}
  <div style="background-image:url({{images.0.url}})" data-album-id="{{id}}" class="cover"></div>
  {{/each}}
</script>


</body>

<script>
// find template and compile it
var templateSource = document.getElementById('results-template').innerHTML,
  template = Handlebars.compile(templateSource),
  resultsPlaceholder = document.getElementById('results'),
  playingCssClass = 'playing',
  audioObject = null;

var fetchTracks = function(albumId, callback) {
  $.ajax({
    url: 'https://api.spotify.com/v1/albums/' + albumId,
    success: function(response) {
      callback(response);
    }
  });
};

var searchAlbums = function(query) {
  $.ajax({
    url: 'https://api.spotify.com/v1/search',
    data: {
      q: query,
      type: 'album'
    },
    success: function(response) {
      resultsPlaceholder.innerHTML = template(response);
    }
  });
};

results.addEventListener('click', function(e) {
  var target = e.target;
  if (target !== null && target.classList.contains('cover')) {
    if (target.classList.contains(playingCssClass)) {
      audioObject.pause();
    } else {
      if (audioObject) {
        audioObject.pause();
      }
      fetchTracks(target.getAttribute('data-album-id'), function(data) {
        audioObject = new Audio(data.tracks.items[0].preview_url);
        audioObject.play();
        target.classList.add(playingCssClass);
        audioObject.addEventListener('ended', function() {
          target.classList.remove(playingCssClass);
        });
        audioObject.addEventListener('pause', function() {
          target.classList.remove(playingCssClass);
        });
      });
    }
  }
});

document.getElementById('search-form').addEventListener('submit', function(e) {
  e.preventDefault();
  searchAlbums(document.getElementById('query').value);
}, false);

</script>

<script>

var app = angular.module('myApp', []); //the overall module

app.controller('myCtrl', function($scope, $timeout, $http){ //my controller... functions in here

});

</script>



</html>
